# 作用域

一个声明的作用域是所声明实体可以通过简单名引用的程序区域。
- 可见顶级包的声明的作用域为所有可见的编译单元
- 不可见的包声明总不在作用域
- 子包声明总不在作用域
- 包`java`总在作用域中
- 单类型导入声明或按需类型导入声明作用域是所在编译单元的所有类和接口类型，还有包声明的注解
- 单静态导入声明或按需静态导入声明作用域是所在编译单元的所有类和接口类型，还有包声明的注解
- 顶级类型的作用域为所在包的所有类型声明
- 类声明或继承的成员声明的作用域为整个类体（包括嵌套类型声明）
- 接口声明或继承的成员声明的作用域为整个接口（包括嵌套类型声明）
- 枚举常量的作用域为枚举类的体和表达式类型为该枚举类的`switch`语句
- 方法、构造器、lambda表达式形参的作用域对应的体
- 类类型参数的作用域为类声明的类型参数部分、超接口和超类的类型参数部分、类体
- 接口类型参数的作用域为接口声明的类型参数部分、超接口的类型参数部分、接口体
- 方法类型参数的作用域为整个方法声明，方法修饰符除外
- 构造器类型参数的作用域为整个构造器声明，构造器修饰符除外
- 块中直接包围的局部类声明的作用域为块中余下部分（包括类声明自身）
- `switch`块中直接包围的局部类声明的作用域为块中余下部分（包括类声明自身）
- 块中局部变量声明的作用域为块中余下部分（从初始化器开始）
- `ForInit`部分局部变量声明的作用域包括其初始化器、`ForInit`中后续声明、`Expression`、`ForUpdate`和包含的语句
- 增强`for`循环的`FormalParameter`部分局部变量声明的作用域为包含的语句
- 异常处理器参数的作用域为对应`catch`块
- `ResourceSpecification`中局部变量声明的作用域为`ResourceSpecification`余下部分和整个`try`块

局部变量、形参、异常参数、局部类只能用简单名引用。引致两个同名局部变量、形参、异常参数、局部类的作用域相交的声明是不容许的：
- 形参名不能用于在方法、lambda表达式或构造器体中声明同名变量，除非在体中类声明内
- 局部变量名不能用于在其作用域中声明同名变量，除非在作用域中类声明内
- 异常参数名不能用于在`catch`块中声明同名变量，除非在子句中类声明内
- 局部类名不能用于在其作用域中声明同名局部类，除非在作用域中类声明内

## 遮盖

一个声明在一点可见当且仅当该点在声明作用域内且没有被其它声明遮盖。

- 类型声明在其作用域遮盖所有其它同名声明
- 域或形参声明遮盖其它声明时作用域中的变量
- 局部变量和异常参数声明在其作用域遮盖声明时在作用域的同名域声明和变量声明
- 方法声明遮盖声明时在外围作用域的的同名方法
- 单类型导入声明在编译单元遮盖所在包其它编译单元的同名顶级类型、相同编译单元的按需类型导入声明导入的同名类型、相同编译单元的按需静态导入声明导入的同名类型
- 导入域的单静态导入声明在编译单元遮盖相同编译单元的按需静态导入声明导入的同名域
- 导入方法的单静态导入声明在编译单元遮盖相同编译单元的按需静态导入声明导入的同名方法
- 导入类型的单静态导入声明在编译单元遮盖所在包其它编译单元的同名顶级类型、相同编译单元的按需类型导入声明导入的同名类型、相同编译单元的按需静态导入声明导入的同名类型

## 阻挡

一个简单名在个别上下文可能同时可解读为变量、类型和包，这时变量优先于类型、类型优先于包，于是可能无法用简单名指向可见的类型或包，这时称其声明被阻挡。

# 名字的意义

```
PackageName:
	Identifier
	PackageName . Identifier
TypeName:
	Identifier
	PackageOrTypeName . Identifier
PackageOrTypeName:
	Identifier
	PackageOrTypeName . Identifier
ExpressionName:
	Identifier
	AmbiguousName . Identifier
MethodName:
	Identifier
AmbiguousName:
	Identifier
	AmbiguousName . Identifier
```

按照上下文，每个名字分为：
- `PackageName`
    - 对于简单名，表示有指定名的顶级包。没有这样的包在作用域是编译期错误。
    - 对于限定名`Q.Id`，`Q`必须为包名，则`Q.Id`表示包`Q`的名为`Id`的成员包。若`Q`不命名可见包或`Id`不是其可见子包，则是编译期错误。
- `TypeName`
    - 对于简单名，则表示惟一可见的同名类型声明。
    - 对于限定名`Q.Id`，表示类型或包`Q`的惟一可访问成员类型`Id`，没有则是编译期错误。
- `ExpressionName`
    - 对于简单名，则表示这点可见的局部变量、参数或域声明，没有是编译期错误。若声明的是实例变量，则表达式名字只能出现于实例方法、构造器、实例初始化器或实例变量的初始化器。若声明的`final`变量在简单表达式前肯定赋值过，则名字的意义是变量的值，否则是声明的变量。若表达式名字出现在赋值上下文、调用上下文或转换上下文，则类型为域、局部变量或参数声明类型的捕获转换，否则为声明类型。
    - 对于限定名`Q.Id`
        - 若`Q`为包名，是编译期错误
        - 若`Q`命名类类型的类型名
            - 若没有类的惟一可访问成员域为`Id`，则是编译期错误
            - 否则若上述域不是类变量，则是编译期错误
            - 否则若类变量声明为`final`，则`Q.Id`表示类变量的值，类型为声明类型的捕获转换。若`Q.Id`出现在要求变量而非值的上下文，则是编译期错误。
            - 否则`Q.Id`表示类变量，类型为声明类型的捕获转换
        - 若`Q`命名类类型的类型名
            - 若没有接口的惟一可访问成员名为`Id`，则是编译期错误
            - 否则`Q.Id`表示上述域，类型为声明类型的捕获转换。若`Q.Id`出现在要求变量而非值的上下文，则是编译期错误。
        - 若`Q`为表达式名字，`T`为其类型：
            - 若`T`不是引用类型，则是编译期错误
            - 若类型`T`不是恰有一个可访问域成员`Id`，则是编译期错误
            - 否则`Q.Id`表示上述域，类型为声明类型的捕获转换。若为接口的域、类类型的`final`域、数组类型的`length`域，则表示域的值（除非出现在要求变量的上下文且域为肯定未赋值过的空白`final`域），否则表示变量。
- `MethodName`表示被调用方法名，表示方法调用处可见的方法或通过单静态导入或按需静态导入声明的
- `PackageOrTypeName`
    - 对于简单名`Q`
        - 若作用域中有名为`Q`的类型，则重新分类为`TypeName`
        - 否则重新分类为`PackageName`
    - 对于限定名`Q.Id`
        - 类型或包`Q`有成员类型`Id`，则重新分类为`TypeName`
        - 否则重新分类为`PackageName`
- `AmbiguousName`，这时要进一步分类：
    - 对于只由一个标识符组成的简单名：
        - 若名字同标识符的局部变量声明或参数声明或域声明在作用域中，则重新分类为`ExpressionName`
        - 否则若该名字指定的域通过单静态导入或按需静态导入包含，则重新分类为`ExpressionName`
        - 否则若名字在同名顶级类或接口声明、局部类声明或成员类型声明的作用域出现，则重新分类为`TypeName`
        - 否则若该名字指定的类型通过导入声明包含，则重新分类为`TypeName`
        - 否则分类为`PackageName`
    - 对于限定名则最右的`.`左方的名字首先被分类：
        - 若左方分类为`PackageName`，则
            - 若右方标识符是该包声明的类型名，则重新分类为`TypeName`
            - 否则重新分类为`PackageName`
        - 若左方分类为`TypeName`，则：
            - 若右方标识符为指定类型的方法或域名，则重新分类为`ExpressionName`
            - 若右方标识符为指定类型的成员类型名，则重新分类为`TypeName`
            - 否则是编译期错误
        - 若左方分类为`ExpressionName`，令`T`为其类型
            - 若右方标识符为类型`T`的方法或域名，则重新分类为`ExpressionName`
            - 若右方标识符为类型`T`的成员类型名，则重新分类为`TypeName`
            - 否则是编译期错误

# 完全限定名和规范名

每个基本类型、具名包、顶级类、顶级接口和部分其它类型有完全限定名：
- 基本类型完全限定名为对应关键字：`byte`、`short`、`char`、`int`、`long`、`float`、`double`、`boolean`
- 不是具名包的子包的完全限定名为其简单名
- 具名包的子包的完全限定名由前者的完全限定名、`.`和后者简单名组成
- 无名包中声明的顶级类或接口的完全限定名就是它的简单名
- 具名包中声明的顶级类或接口的完全限定名由包的完全限定名、`.`和类型的简单名组成
- 若类或接口有完全限定名，则其成员类或接口有完全限定名，由前者完全限定名、`.`和后者的简单名组成
- 若分量类型有完全限定名，则数组类型的完全限定名由分量类型的完全限定名和`[]`组成

每个基本类型、具名包、顶级类、顶级接口和部分其它类型有规范名：
- 每个基本类型、具名类、顶级类、顶级接口的规范名与完全限定名相同
- 若类或接口有规范名，则其中声明的成员类或接口有规范名，由前者规范名、`.`和后者的简单名组成
- 若分量类型有规范名，则数组类型的规范名由分量类型的规范名和`[]`组成

# 可访问性

- 包总是可访问
- `public`类或接口可以被所有代码访问，只要所在编译单元可见
- 包访问（没有访问修饰符）的类或接口只能从声明它的包访问
- 一个数组类型可访问当且仅当其分量类型可访问
- 引用类型的成员（类、接口、域、方法）或类构造器可访问当且仅当类型可访问且成员或构造器可访问：
    - 成员或构造器声明为`public`
    - 否则，若成员或构造器声明为`protected`，则以下之一：
        - 在声明它的包访问
        - 
	    - 对于成员访问，只能出现于成员所属类`C`的子类，记`Id`为实例域或方法
                - 若通过`Q.Id`或`Q :: Id`，其中`Q`为表达式名字，则`Q`类型为`S`或其子类
		- 若通过`E.Id`或`E.Id(...)`或`E :: Id`，其中`E`为初等表达式，则`E`的类型为`S`或其子类
                - 若通过`T :: Id`其中`T`为引用类型，则`T`为`S`或其子类
	    - 对于限定的构造器访问，令声明的类为`C`、进行访问的类为`S`
	        - 若通过`super(...)`或`E.super(...)`，其中`E`为初等表达式，则容许访问
                - 若通过`new C(...) {...}`或`E.new C(...){...}`访问，其中`E`为初等表达式，则容许访问
                - 若通过`new C(...)`或`E.new C(...)`或`C :: new`，其中`E`为初等表达式，则不容许访问
    - 否则若成员或构造器声明为包访问，则只能在声明它的包访问
    - 否则若成员或构造器声明为`private`，则只能在包含成员或构造器声明的顶级类的体中访问

# 命名约定

## 包名

包名前缀应当由你的域名反转各分量位置而得，如包名的第一分量为小写的顶级域名，
- 若有不能用于标识符的字符，用`_`代替
- 若分量为关键字或由不能作为标识符首个字符的字符开始，则在前面加上`_`

## 类和接口名

类或接口名应当为描述性名词或名词词组，每个单词首字母大写，不宜太长。接口名也可以是描述行为的形容词。

## 类型变量名

类型变量最好是单字符的，不包括小写字母。如容器类可用`E`作为元素类型，映射可用`K`、`V`表示键、值类型，可用`X`表示异常类、可用`T`表示一般的类型。当有多个类型参数用途类似时应用相邻字母，或者用数字标识。

对于泛型类或泛型方法中的泛型类，最好用不同类型参数以免混淆。

## 方法名

方法名应该是动词或动词词组，首字母小写，其后每个单词首个字母大写。
- 获取和设置属性`V`的方法应名为`getV`和`setV`
- 返回长度的方法应名为`length`
- 测试布尔条件`V`的方法应名为`isV`
- 转换为格式`F`的方法应名为`toF`

## 域名

非`final`域应当用名词、名词词组或缩写，首字母小写，其后每个单词首个字母大写。

## 常量名

接口中常量和类类型的`final`变量的名称应当描述性且避免缩写，由以`_`分隔的一些全大写单词组成，可以带前缀。

## 局部变量和参数名

局部变量和参数名应当短但有意义，由小写字母组成，如：
- 首字母缩写
- 缩写，如`buf`
- 惯例，如`in`和`out`、`off`和`len`

临时或循环变量或参数可用单字母名：
- `b`表示`byte`
- `c`表示`char`
- `d`表示`double`
- `e`表示`Exception`
- `f`表示`float`
- `i`、`j`、`k`表示`int`
- `l`表示`long`
- `o`表示`Object`
- `s`表示`String`
- `v`表示任意值

由两三个小写字母组成的变量或参数名应当不与国家代码或包名的首个分量冲突。