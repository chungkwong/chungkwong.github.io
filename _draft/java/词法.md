# 词法回顾 #

Java程序由Unicode字符组成，当前的Java SE 8支持Unicode 6.2。Unicode的目标为给每个字符提供了一个唯一的数字，现在实际上几乎所有我们可能碰到的字符都有Unicode，不管是什么语言的，关于Unicode详情请参考<http://www.unicode.org/>。我们称一个字符的Unicode为其代码点。Unicode有效代码点范围从 U+0000 到 U+10FFFF，其中 U+n 为十六进制记号，代码点大于 U+FFFF 的字符称为增补字符。UTF-16编码用16位单元表示字符（Unicode原来只用16位，后来发现不够用，又要保持向后兼容性），其中，增补字符表示为一个范围从U+D800 到 U+DBFF的高代理项代码单元和一个范围从U+DC00 到 U+DFFF的低代理项代码单元，而其它字符表示为单个与Unicode相同的代码单元。Unicode前128个字符的UTF-16编码与ASCII (American Standard Code for Information Interchange, ANSI X3.4) 一致。


## 分词过程 ##

  - 把Unicode转义转换为对应的UTF-16单元，其中Unicode转义由`\`开始，然后是一个或以上的`u`（容许多个`u`是为了让Unicode程序与等价ASCII程序间转换native2ascii精确可逆，如`\uxxxx`对应于`\uuxxxx`），最后是四个十六进制数字（`0 1 2 3 4 5 6 7 8 9 a b c d e f A B C D E F`之一）。这使所有程序都可以只用ASCII字符表达。
  - 切分为输入字符和行结束符(CR、LF或CR LF)的序列。
  - 按最长匹配原则分成输入元素并抛弃空白和注释（还有输入结尾可选的ASCII 字符 SUB ，即control-Z也不管）。例外是若在类型上下文中，两个或以上连着的>后面不是>，则每个>都分成>。例如 `a--b` 被分成 `a`, `--`, `b` 而非 `a`, `-`, `-`, `b` 。而`List<List<String>>`被分成`List`, `<`, `List`, `<`, `String`, `>`, `>`，而非`List`, `<`, `List`, `<`, `String`, `>>`。


## 输入元素 ##

### 空白 ###

  * ASCII 字符 SP， 即空格
  * ASCII 字符 HT， 即水平制表符
  * ASCII 字符 FF， 即垂直制表符
  * 行结束符

### 注释 ###

  * 传统注释从"/*"开始到之后首个"*/"
  * 行末注释由两个反斜杠"//"开始至所在行结束

可见，注释不能嵌套：
- `/*some/*thing*/*/`分词为`*`、`/`
- `/*some//thing*/12`分词为`12`
- `//some/*thing`分词为空序列

注释也不能出现在字符字面值或字符串字面值中。

### 标识符 ###

标识符由至少一个Unicode字符组成，关键字、布尔字面值和null字面值除外，其中首个字符为Java字母，余下字符为Java字母或Java数字。Java字母是指Character.isJavaIdentifierStart(int)返回true的Unicode字符，包括但不限于[a-zA-Z_$]。Java字母或Java数字是指Character.isJavaIdentifierPart(int)返回true的Unicode字符，包括但不限于[a-zA-Z0-9_$]。由于很多中日韩字符均在此列，这意味着我们可以把各种名字取成中文。

两个标识符相等当且仅当它们有相同的Unicode序列，这意味着Java的标识符区分大小写，而且组合字符与其分解序列不等同。

`$`习惯上只应用于机器生成的名字。

### 关键字 ###

以下50个由ASCII字符组成的记号为关键字，不能用作标识符：

```
    abstract   continue   for          new         switch
    assert     default    if           package     synchronized
    boolean    do         goto         private     this
    break      double     implements   protected   throw
    byte       else       import       public      throws
    case       enum       instanceof   return      transient
    catch      extends    int          short       try
    char       final      interface    static      void
    class      finally    long         strictfp    volatile
    const      float      native       super       while
```
值得注意的是：
- `goto`和`const`在Java没有被使用
- `true`、`false`、`null`技术上不是关键字

### 字面值 ###

#### 整数字面值 ####

`int`类型字面值可用以下进制表示：

  * 十进制数值除`0`外，由非零数字（`1 2 3 4 5 6 7 8 9`）开始，后接零个或多个数字（`0 1 2 3 4 5 6 7 8 9`），中间可夹杂纯粹为好看加上的下划线`_`。注意值只能从0 到 2147483648，其中2147483648只能用作负号`-`的操作数。
  * 十六进制数值（补码）由`0x`或`0X`开始，后接一个或多个数字（`0 1 2 3 4 5 6 7 8 9 a b c d e f A B C D E F`），中间可夹杂纯粹为好看加上的下划线`_`。注意值必须作为二的补码可容纳在`int`类型中。
  * 八进制数值（补码）由`0`，后接一个或多个数字（`0 1 2 3 4 5 6 7`），中间可夹杂纯粹为好看加上的下划线`_`。注意值必须作为二的补码可容纳在`int`类型中。
  * 二进制数值（补码）由`0b`或`0B`开始，后接一个或多个数字（`0 1`），中间可夹杂纯粹为好看加上的下划线`_`。注意值必须作为二的补码可容纳在`int`类型中。

`long`类型字面值与`int`类型类似，只用在最后加上`l`或`L`（推荐用后者以免与`1`混淆）。相应地，十进制表示的值0 到 9223372036854775808，其中9223372036854775808只能用作负号`-`的操作数，而其它进制表示的二的补码必须能容纳在`long`类型中。

#### 浮点数字面值 ####

`double`类型字面值可用以下进制表示：

  * 十进制数值由一个或多个数字（`0 1 2 3 4 5 6 7 8 9`）开始，其中混有至多一个小数点`.`（可在首尾或中间）。后面是可选的是指数部分，`e`或`E`，然后是一个可选的符号（`+ -`）和十进制整数。没有小数点的话就要有指数部分。
  * 十六进制数值（补码）由`0x`或`0X`开始，后接一个或多个数字（`0 1 2 3 4 5 6 7 8 9 a b c d e f A B C D E F`），其中混有至多一个小数点`.`（可在首尾或中间），再是`p`或`P`，最后是一个可选的符号（`+ -`）和十进制整数。

其中各数字之间可以夹杂若干个下划线以提高可读性。

`float`类型字面值与`double`类型类似，只用在最后加上`f`或`F`。其实，double类型字面值最后也可以加上`d`或`D`。

`double`和`float`的特殊值，可用`Double`和`Float`类中的域`POSITIVE_INFINITY`、`NEGATIVE_INFINITY`和`NaN`取得。

非零浮点数字面值绝对值不能大到或小到按IEEE 754成为无穷或零。

#### 布尔字面值 ####

`boolean`类型的两个值，用ASCII字符序列表示：

```
    true false
```

#### 字符字面值 ####

`char`类型的代码单元表示为用单引号`'`括起的单个非`'`非`\`非行结束符的字符或转义序列。

其中，转义序列有：

  * `\b` (表示退格 BS, U+0008)
  * `\t` (表示水平制表符 HT, U+0009)
  * `\n` (表示换行 LF, U+000a)
  * `\f` (表示垂直制表符 FF, U+000c)
  * `\r` (表示回车 CR, U+000d)
  * `\"` (表示双引号 ", U+0022)
  * `\'` (表示单引号 ', U+0027)
  * `\\` (表示反斜杠 \, U+005c)
  * `\o`（表示1位八进制Unicode）
  * `\oo`（表示2位八进制Unicode）
  * `\ooo`（表示3位八进制Unicode，最大为`\377`）
  
其中，八进制转义为保持与C的兼容性，用Unicode转义才能表示所有Unicode字符。

值得注意的是，`'\u000a'`不合法是因为`\u000a`在很早就被换成LF，`'\u000d'`类似。


#### 字符串字面值 ####

`String`类型的值表示为双引号`"`括起的零个或以上非`"`非`\`非行结束符的字符或转义序列。

  * 相等的字符串字面值（和编译期计算的常量字符串）指向同一`String`对象，即使在不同包和类
  * `String`对象调用`intern`返回的`String`对象与相等的字符串字面值所指相同

同理`"\u000a"`、`"\u000d"`和`"\u0022"`不合法。

#### null字面值 ####

null类型的惟一值，即空引用，用ASCII字符序列表示：

```
    null
```

### 分隔符 ###

以下12个由ASCII字符组成的记号为分隔符（标号）：

```
    (   )   {   }   [   ]   ;   ,   .   ...   @   ::
```
### 运算符 ###

以下38个由ASCII字符组成的记号为运算符：

```
    =   >   <   !   ~   ?   :   ->
    ==  >=  <=  !=  &&  ||;  ++  --
    +   -   *   /   &   |   ^   %   <<   >>   >>>
    +=  -=  *=  /=  &=  |=  ^=  %=  <<=  >>=  >>>=
```